<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PIET — Result Lookup</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #4f46e5, #9333ea);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #222;
    }
    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.25);
      max-width: 900px;
      width: 100%;
    }
    h4 {
      font-weight: 700;
      color: #4f46e5;
      border-bottom: 3px solid #9333ea;
      display: inline-block;
      padding-bottom: 4px;
    }
    .subject-pill {
      display:inline-block;
      margin:4px;
      padding:6px 12px;
      border-radius:20px;
      font-weight:600;
      color:#fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      font-size: 0.9rem;
    }
    .grade-A, .grade-Ap, .grade-App { background:#16a34a; } /* Greens */
    .grade-B { background:#2563eb; }
    .grade-C, .grade-D { background:#f59e0b; }
    .grade-F { background:#dc2626; }
    .summary {
      margin-top:12px;
      font-weight:600;
      padding:10px;
      background:#f1f5f9;
      border-radius:8px;
      font-size:1rem;
    }
    .footer {
      margin-top: 20px;
      text-align:center;
      color:#f1f5f9;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="card p-4">
    <h4>PIET — Result Lookup</h4>
    <div class="row g-2 align-items-end mt-2">
      <div class="col-md-6">
        <label class="form-label">Registration Number</label>
        <input id="reg" class="form-control" placeholder="PIET23CS001" value="PIET23CS001">
      </div>
      <div class="col-md-3">
        <label class="form-label">Branch</label>
        <select id="branch" class="form-select">
          <!-- Ordered list of branches -->
          <option value="AI&DS-E">AI&DS-E</option>
          <option value="CS(AI)-F">CS(AI)-F</option>
          <option value="CS(DS)-G">CS(DS)-G</option>
          <option value="CS">CS</option>
          <option value="CSR-D">CSR-D</option>
          <option value="CS(IOT)-H">CS(IOT)-H</option>
        </select>
      </div>
      <div class="col-md-3">
        <button id="btn" class="btn btn-primary w-100">Get Result</button>
      </div>
    </div>
    <div id="msg" class="mt-3"></div>
    <div id="results" class="mt-3"></div>
  </div>
  <div class="footer">
    Developed by Department of AI &amp; DS, PIET Jaipur
  </div>
</div>
<script>
const btn = document.getElementById('btn');
const regInput = document.getElementById('reg');
const branchSelect = document.getElementById('branch');
const results = document.getElementById('results');
const msg = document.getElementById('msg');

function gradeClass(g){
  g = (g||'').toUpperCase();
  if(g==='A++'||g==='A+') return 'grade-App';
  if(g.startsWith('A')) return 'grade-A';
  if(g.startsWith('B')) return 'grade-B';
  if(g.startsWith('C')||g.startsWith('D')) return 'grade-C';
  if(g==='F'||g.includes('FAIL')) return 'grade-F';
  return 'grade-B';
}

btn.addEventListener('click', async ()=>{
  results.innerHTML=''; msg.innerHTML='';
  const reg = regInput.value.trim(); const branch = branchSelect.value;
  if(!reg){ msg.innerHTML='<div class="alert alert-warning">Enter registration number</div>'; return; }
  btn.disabled=true; btn.innerText='Searching...';
  try{
    const qs = new URLSearchParams({reg, branch});
    const resp = await fetch('/api/result?'+qs.toString());
    const data = await resp.json();
    if(resp.status===200){
      const rows = data.result || [];
      if(rows.length===0){ results.innerHTML='<div class="alert alert-info">No record found</div>'; }
      else{
        const r = rows[0];
        let html = `<h5 class="mt-3">${r["Name"]} <small class="text-muted">(${r["Reg. No"]})</small></h5>`;
        html += `<div class="text-muted mb-2">Uni-Roll: ${r["Uni-Roll No"]||""} · Col Roll: ${r["Col Roll No"]||""}</div>`;
        html += `<div class="mb-3">`;
        Object.keys(r).forEach(k=>{
          if(!["Reg. No","Name","Uni-Roll No","Col Roll No","Total Back","Result","SGPA"].includes(k)){
            const g = r[k];
            let subjectName = k.split(" (")[0];  // drop code for pills
            html += `<span class="subject-pill ${gradeClass(g)}">${subjectName} — ${g}</span>`;
          }
        });
        html += `</div>`;
        // Summary
        const resultStatus = r["Result"]||"";
        let badge = resultStatus.toLowerCase().includes("pass") 
            ? `<span class="badge bg-success">${resultStatus}</span>` 
            : `<span class="badge bg-danger">${resultStatus}</span>`;
        html += `<div class="summary">SGPA: ${r["SGPA"]||""} · Total Back: ${r["Total Back"]||""} · Result: ${badge}</div>`;
        results.innerHTML = html;
      }
    } else {
      msg.innerHTML = '<div class="alert alert-danger">'+(data.error||'Request failed')+'</div>';
    }
  }catch(err){
    msg.innerHTML = '<div class="alert alert-danger">'+err.message+'</div>';
  } finally {
    btn.disabled=false; btn.innerText='Get Result';
  }
});
</script>
</body>
</html>
